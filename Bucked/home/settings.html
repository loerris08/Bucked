<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bucked Settings</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="style2.css">
</head>

<body>

  <div class="standard">
    <nav class="menu menu1">
      <input type='checkbox' onclick='updatemenu()'><label></label>
      <ul>
        <li><a href='aahome.html'>ğŸš</a></li>
        <li class="bucked2">Bucked</li>
        <li><a href='profile.html'><img class="picture" src="profilepicture.png"></a></li>
      </ul>
    </nav>



<div style="padding: 10px; display: flex; justify-content: center; gap: 20px;">
  <button class="button2" onclick="window.location.href='../pre/login.html'">Log Out</button>
  <button class="button2" onclick="deleteaccount()">Delete Account</button>
</div>

<div style="padding: 10px; display: flex; justify-content: center; padding-top: 20px; width: 300px; margin-left: 40px;">
<select id="country" name="country" class="padding" style="font-family:lucida handwriting cursive; align-items: center;">
  <option value="">--Please select Country --</option>
  <option value="de">Deutschland</option>
  <option value="at">Ã–sterreich</option>
  <option value="ch">Schweiz</option>
  <option value="fr">Frankreich</option>
  <option value="it">Italien</option>
  <option value="non">Other</option>
</select>
</div>

<div style="padding: 10px; display: flex; justify-content: center;">
  <button class="button2">Verificate your AccountğŸ’«</button>
</div>
<div style="padding: 10px; display: flex; justify-content: center;">
  <button class="button2" onclick="window.location.href='../pre/info.html'">Data protection</button>
</div>

<div style="padding: 10px; display: table-column; justify-content: center;" class="text">
  Suggestions, Feedback or Problems? <br>
  Contact us via <br><a href="https://instagram.com"><img src="icons8-instagram-48.png"></a> <a href=""><img src="icons8-twitter-48.png"></a> <a href="https://discord.gg/xATPJBGq"><img src="icons8-discord-logo-48.png" ></a><br> or <br><a href="https://workspace.google.com/intl/us/gmail">bucked.app@gmail.com </a>
</div>
<div style="padding: 10px; display: table-column; justify-content: center;" class="text">
Follow us to stay updated!
</div>
<div style="padding: 10px; display: table-column; justify-content: center; font-size: 12px;" class="text" >
  And thanks to <a href="https://icons8.com/">Icons8.com</a>
</div>


    <nav class="menu menu2">
      <input type='checkbox' id='responsive-menu' onclick='updatemenu()'><label></label>
      <ul>
        <li><a href='owngoals.html'>ğŸ“</a></li>
        <li><a href='addgoal.html' style="font-size: 95px;">+</a></li>
        <li><a href='discover.html'>ğŸ”</a></li>
      </ul>
    </nav>

  </div>





<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, deleteUser, EmailAuthProvider, reauthenticateWithCredential } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
  import { getFirestore, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
  import { setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

  // Firebase Config (gleiches Projekt wie login/signup)
  const firebaseConfig = {
    apiKey: "AIzaSyDahPBRsjOGgalkR3raXagtKytGn9n1SdE",
    authDomain: "bucked.firebaseapp.com",
    projectId: "bucked",
    storageBucket: "bucked.firebasestorage.app",
    messagingSenderId: "83783824498",
    appId: "1:83783824498:web:da41e3e5dfbe131441beeb",
    measurementId: "G-F3VYK204YW"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Session Persistence setzen
  setPersistence(auth, browserLocalPersistence)
    .then(() => console.log("Persistence gesetzt"))
    .catch(err => console.error("Persistence Fehler:", err));

  // PrÃ¼fen ob User eingeloggt
  onAuthStateChanged(auth, (user) => {
    if (!user) {
      window.location.href = "../pre/login.html";
    }
  });

  // Account lÃ¶schen mit Passwortabfrage
  async function deleteaccount() {
  const user = auth.currentUser;

  if (!user) {
    // Optional: kleine VerzÃ¶gerung, falls Firebase noch lÃ¤dt
    alert("Bitte logge dich zuerst ein!");
    return;
  }

  const password = prompt("Bitte gib dein Passwort ein, um dein Konto zu lÃ¶schen:");
  if (!password) {
    alert("Du musst dein Passwort eingeben!");
    return;
  }

  try {
    const credential = EmailAuthProvider.credential(user.email, password);
    await reauthenticateWithCredential(user, credential);

    await deleteDoc(doc(db, "users", user.uid));
    await deleteUser(user);

    alert("Account erfolgreich gelÃ¶scht.");
    window.location.href = "../pre/sign-up.html";

  } catch (error) {
    console.error("Fehler beim LÃ¶schen:", error);
    alert("Fehler: " + error.message);
  }
}

  window.deleteaccount = deleteaccount;
</script>


</body>

</html>